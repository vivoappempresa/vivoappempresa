<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VIVO SMART EMPRESA</title>
  <link rel="stylesheet" href="../css/style.css">
</head>

<body>
  <div class="container">
    <h1>Móvel Planos Smart Empresas</h1>

    <div class="section">
      <h3>Planos Móveis</h3>
      <div class="mobile-plan">
        <label>
          <input type="checkbox" value="39.99" data-gb="6"> 6GB - R$ 39,99
          <input type="number" min="0" value="0">
          <span></span>
        </label>
      </div>
      <div class="mobile-plan">
        <label>
          <input type="checkbox" value="54.99" data-gb="15"> 15GB - R$ 54,99
          <input type="number" min="0" value="0">
          <span></span>
        </label>
      </div>
      <div class="mobile-plan">
        <label>
          <input type="checkbox" value="59.99" data-gb="20"> 20GB - R$ 59,99
          <input type="number" min="0" value="0">
          <span></span>
        </label>
      </div>
      <div class="mobile-plan">
        <label>
          <input type="checkbox" value="69.99" data-gb="30"> 30GB - R$ 69,99
          <input type="number" min="0" value="0">
          <span></span>
        </label>
      </div>
      <div class="mobile-plan">
        <label>
          <input type="checkbox" value="79.99" data-gb="40"> 40GB - R$ 79,99
          <input type="number" min="0" value="0">
          <span></span>
        </label>
      </div>
      <div class="mobile-plan">
        <label>
          <input type="checkbox" value="89.99" data-gb="50"> 50GB - R$ 89,99
          <input type="number" min="0" value="0">
          <span></span>
        </label>
      </div>
      <div class="mobile-plan">
        <label>
          <input type="checkbox" value="99.99" data-gb="100"> 100GB - R$ 99,99
          <input type="number" min="0" value="0">
          <span></span>
        </label>
      </div>
    </div>

    <div class="section">
      <h3>Adicionar MDM</h3>
      <label>
        <input type="number" id="mdm-quantity" value="0" min="0"> Quantidade de MDM (+ R$ 5 cada)
      </label>
    </div>

    <div class="section">
      <h3>Adicionais</h3>
      <label>
        <input type="checkbox" id="additional1" value="10.00" data-gb="10">
        10GB + Redes sociais
      </label>
      <label>
        <input type="checkbox" id="additional2" value="10">
        10GB + streaming \YouTube\TikTok
      </label>
    </div>

    <h2 id="totalPrice">Preço Total: R$ 0,00</h2>
    <h3 id="totalGB">Total de GB: 0GB</h3>
  </div>

  <!-- Imagem que será alterada conforme a seleção de MDM -->
  <img class="changeable" src="movelsmart.png" alt="Móvel Planos Smart Empresas"
    style="max-width:50%; display:block; margin:20px auto;">

  <br>
  <br>

  <!-- Seção do analisador, inserida abaixo da imagem -->
  <div class="analyzer">
    <h3>Gerar Plano por Linhas</h3>
    <label>
      Valor Pago Atual:
      <input type="number" id="valor" min="0" step="0.01" placeholder="Ex: 210">
    </label>
    <label>
      Total de GB:
      <input type="number" id="gb" min="0" placeholder="Ex: 70">
    </label>
    <label>
      Quantidade de Linhas:
      <input type="number" id="linhas" min="1" value="1">
    </label>
    <button onclick="analyzeBestPlan()">ANALISAR MELHOR PLANO</button>
    <div class="suggestions" id="suggestions"></div>
  </div>

  <div class="benefits">
    <h3>Benefícios</h3>
    <p>Internet ilimitada caso acabe seus GB ela não para.</p>
    <p>Ligação para todo Brasil e qualquer operadora ilimitado.</p>
    <p>SMS ilimitado.</p>
    <p>Proteção de dados caso entre em site duvidoso.</p>
    <p>REDE SOCIAL ILIMITADO /WhatsApp.</p>
    <p>Conexão 5G em todo Brasil.</p>
    <p>Também pode compartilhar sua conexão com amigos que use a Vivo também.</p>
    <p>Realizar compra de aparelhos tipo telefone ou computadores com a gente na Vivo, com descontos de até 70%.</p>
    <p>O chip sai de graça e mandamos pro seu endereço e não perde o número.</p>
  </div>

  <script>
    function calculateTotal() {
      let total = 0;
      let totalGB = 0;
      const mobileOptions = document.querySelectorAll('.mobile-plan');
      const mdmQuantity = parseInt(document.getElementById('mdm-quantity').value) || 0;
      const additional1 = document.getElementById('additional1');
      const additional2 = document.getElementById('additional2');

      // Soma os valores dos planos selecionados e os GBs
      mobileOptions.forEach(option => {
        const quantity = parseInt(option.querySelector('input[type="number"]').value) || 0;
        const price = parseFloat(option.querySelector('input[type="checkbox"]').value);
        const gb = parseInt(option.querySelector('input[type="checkbox"]').dataset.gb);  // Quantidade de GB
        total += price * quantity; // Multiplica o preço pela quantidade
        totalGB += gb * quantity; // Soma a quantidade total de GB
      });

      // Adiciona o custo do MDM (considerando a quantidade selecionada)
      total += 5 * mdmQuantity;

      // Adiciona os custos dos adicionais e os GBs correspondentes
      if (additional1.checked) {
        total += 10;  // Adiciona 10 para o adicional de 10GB + redes sociais
        totalGB += 10; // Adiciona 10GB ao total
      }
      if (additional2.checked) {
        total += 10;  // Adiciona 10 para o adicional de 10GB + plataformas de streaming
        totalGB += 10; // Adiciona 10GB ao total
      }

      // Atualiza o título e a imagem de acordo com a seleção
      if (mdmQuantity > 0) {
        document.querySelector('h1').textContent = `Móvel Combo + ${mdmQuantity} MDM`;
        document.querySelector('img.changeable').src = "movelsmartmdm.png";  // Caminho da imagem com MDM
      } else {
        document.querySelector('h1').textContent = "Móvel Planos Smart Empresas";
        document.querySelector('img.changeable').src = "movelsmart.png";  // Caminho da imagem sem MDM
      }

      // Exibe o total de preço e o total de GB selecionados
      document.getElementById('totalPrice').textContent = `Preço Total: R$ ${total.toFixed(2)}`;
      document.getElementById('totalGB').textContent = `Total de GB: ${totalGB}GB`;
    }

    document.addEventListener('change', calculateTotal);

    // Lista de planos disponíveis para o analisador
    const plans = [
      { name: '6GB', gb: 6, price: 39.99 },
      { name: '15GB', gb: 15, price: 54.99 },
      { name: '20GB', gb: 20, price: 59.99 },
      { name: '30GB', gb: 30, price: 69.99 },
      { name: '40GB', gb: 40, price: 79.99 },
      { name: '50GB', gb: 50, price: 89.99 },
      { name: '100GB', gb: 100, price: 99.99 }
    ];

    // Função para agrupar e resumir uma combinação (ex: "2 linha(s) de 6GB + 1 linha(s) de 100GB")
    function summarizeCombination(comb) {
      const summary = {};
      comb.forEach(plan => {
        if (!summary[plan.name]) {
          summary[plan.name] = { count: 0, price: plan.price, gb: plan.gb };
        }
        summary[plan.name].count++;
      });
      const parts = [];
      for (const key in summary) {
        const item = summary[key];
        parts.push(`${item.count} linha(s) de ${key} (R$ ${item.price.toFixed(2)} c/ ${item.gb}GB)`);
      }
      return parts.join(' + ');
    }

    // Função recursiva para gerar combinações (com repetição) para n linhas.
    // Usamos o parâmetro "start" para evitar repetições (ordem não importa)
    function getCombinations(n, start = 0, current = [], all = []) {
      if (current.length === n) {
        all.push([...current]);
        return;
      }
      for (let i = start; i < plans.length; i++) {
        current.push(plans[i]);
        getCombinations(n, i, current, all);
        current.pop();
      }
      return all;
    }

    function analyzeBestPlan() {
      const valor = parseFloat(document.getElementById('valor').value) || 0;
      const gbTotal = parseInt(document.getElementById('gb').value) || 0;
      const linhas = parseInt(document.getElementById('linhas').value) || 1;
      const suggestionsElem = document.getElementById('suggestions');
      suggestionsElem.innerHTML = ''; // Limpa sugestões anteriores

      if (valor <= 0 || gbTotal <= 0 || linhas < 1) {
        suggestionsElem.innerHTML = '<p>Preencha todos os campos corretamente.</p>';
        return;
      }

      // Gerar todas as combinações para o número de linhas informado
      const allCombinations = getCombinations(linhas);

      // Mapeia as combinações para seus totais: custo e GB
      const validCombs = allCombinations.map(comb => {
        const totalCost = comb.reduce((acc, p) => acc + p.price, 0);
        const totalGb = comb.reduce((acc, p) => acc + p.gb, 0);
        return { combination: comb, totalCost, totalGb };
      })
        // Filtra as combinações que não ultrapassam o valor informado e que oferecem GB total ≥ o desejado
        .filter(item => item.totalCost <= valor && item.totalGb >= gbTotal);

      if (validCombs.length === 0) {
        suggestionsElem.innerHTML = '<p>Não foi possível encontrar uma combinação que atenda os requisitos.</p>';
        return;
      }

      // 1. Plano mais econômico: combinação com o menor custo total
      let candidateEconomico = validCombs.reduce((min, curr) =>
        (curr.totalCost < min.totalCost ? curr : min)
      );

      // 2. Plano com mais GB: combinação com o maior total de GB
      let candidateMaisGb = validCombs.reduce((max, curr) =>
        (curr.totalGb > max.totalGb ? curr : max)
      );

      // 3. Plano um pouco mais barato e com mais GB:
      //    Dentre as combinações com custo maior que o plano mais econômico e com GB total maior que o plano mais econômico,
      //    escolhe a de menor custo.
      let candidatesMediano = validCombs.filter(c =>
        c.totalCost > candidateEconomico.totalCost && c.totalGb > candidateEconomico.totalGb
      );
      let candidateMediano = null;
      if (candidatesMediano.length > 0) {
        candidateMediano = candidatesMediano.reduce((min, curr) =>
          (curr.totalCost < min.totalCost ? curr : min)
        );
      } else {
        // Se não houver, utiliza o candidato com mais GB (desde que seja diferente do econômico)
        candidateMediano = candidateMaisGb !== candidateEconomico ? candidateMaisGb : candidateEconomico;
      }

      // Exibe os resultados
      let html = '<h3>Sugestões:</h3>';

      html += `<div class='suggestion-box'><strong>Plano mais econômico:</strong><br>`;
      html += summarizeCombination(candidateEconomico.combination);
      html += `<br>Total: R$ ${candidateEconomico.totalCost.toFixed(2)} | GB Total: ${candidateEconomico.totalGb}GB</div>`;

      html += `<div class='suggestion-box'><strong>Plano com mais GB:</strong><br>`;
      html += summarizeCombination(candidateMaisGb.combination);
      html += `<br>Total: R$ ${candidateMaisGb.totalCost.toFixed(2)} | GB Total: ${candidateMaisGb.totalGb}GB</div>`;

      html += `<div class='suggestion-box'><strong>Plano um pouco mais barato e com mais GB:</strong><br>`;
      html += summarizeCombination(candidateMediano.combination);
      html += `<br>Total: R$ ${candidateMediano.totalCost.toFixed(2)} | GB Total: ${candidateMediano.totalGb}GB</div>`;

      suggestionsElem.innerHTML = html;
    }
  </script>
</body>

</html>